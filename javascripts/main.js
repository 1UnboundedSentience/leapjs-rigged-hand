// Generated by CoffeeScript 1.6.3
(function() {
  var HEIGHT, TO_DEG, TO_RAD, WIDTH, animation, camera, handMesh, pointLight, rectangle, renderer, scene, sphere, sphere2;

  TO_RAD = Math.PI / 180;

  TO_DEG = 1 / TO_RAD;

  THREE.Quaternion.prototype.setFromPoints = function(a, b, c) {
    return this.setFromVectors((new THREE.Vector3).subVectors(a, b).normalize(), (new THREE.Vector3).subVectors(c, b).normalize());
  };

  THREE.Quaternion.prototype.setFromVectors = function(a, b) {
    var angle, axis;
    axis = (new THREE.Vector3).crossVectors(a, b);
    angle = Math.acos(a.dot(b));
    this.setFromAxisAngle(axis, angle);
    return this;
  };

  THREE.Vector3.prototype.visualize = function(scene, color) {
    if (this._arrow) {
      this._arrow.setDirection(this);
    } else {
      this._arrow = new THREE.ArrowHelper(this, new THREE.Vector3(-10, 0, 0), 10, color);
      scene.add(this._arrow);
    }
    return this;
  };

  HEIGHT = window.innerHeight;

  WIDTH = window.innerWidth;

  renderer = new THREE.WebGLRenderer({
    alpha: true
  });

  renderer.setClearColor(0x000000, 1);

  renderer.setSize(WIDTH, HEIGHT);

  document.getElementById('threejs').appendChild(renderer.domElement);

  camera = new THREE.PerspectiveCamera(90, WIDTH / HEIGHT, 1, 1000);

  camera.position.z = 5;

  camera.position.x = 0;

  camera.position.y = 15;

  camera.lookAt(new THREE.Vector3(0, 0, 0));

  scene = new THREE.Scene();

  scene.add(camera);

  scene.add(new THREE.AxisHelper(50));

  scene.add(new THREE.AmbientLight(0x444444));

  pointLight = new THREE.PointLight(0xFFffff);

  pointLight.position = new THREE.Vector3(-20, 10, 0);

  pointLight.lookAt(new THREE.Vector3(0, 0, 0));

  scene.add(pointLight);

  rectangle = new THREE.Mesh(new THREE.CubeGeometry(4, 1, 8), new THREE.MeshPhongMaterial({
    color: 0x00ff00
  }));

  rectangle.position = new THREE.Vector3(0, 0, 0);

  sphere = new THREE.Mesh(new THREE.SphereGeometry(1), new THREE.MeshPhongMaterial({
    color: 0xff0000
  }));

  scene.add(sphere);

  sphere2 = new THREE.Mesh(new THREE.SphereGeometry(1), new THREE.MeshPhongMaterial({
    color: 0xcccc00
  }));

  scene.add(sphere2);

  animation = void 0;

  handMesh = void 0;

  (new THREE.JSONLoader).load('javascripts/14right.json', function(geometryWithBones, materials) {
    var a, avg, b, c, d, fingerLengths, lengthVals, material, num, palmDirection, palmNormal, x, xx, zeroVector, _i, _len;
    material = materials[0];
    material.skinning = true;
    THREE.GeometryUtils.center(geometryWithBones);
    handMesh = new THREE.SkinnedMesh(geometryWithBones, material);
    handMesh.castShadow = true;
    handMesh.receiveShadow = true;
    scene.add(handMesh);
    window.palm = handMesh.children[0].children[0].children[0];
    window.rigFingers = palm.children;
    window.thumb = rigFingers[0];
    window.indexFinger = rigFingers[1];
    window.middleFinder = rigFingers[2];
    window.pinky = rigFingers[3];
    window.ringFinger = rigFingers[4];
    palm.matrixAutoUpdate = false;
    palm.visible = false;
    palmNormal = new THREE.Vector3;
    palmDirection = new THREE.Vector3;
    zeroVector = new THREE.Vector3(0, 0, 0);
    a = (new THREE.Vector3).visualize(scene);
    b = (new THREE.Vector3).visualize(scene, 0xcccccc);
    c = new THREE.Vector3;
    d = new THREE.Vector3;
    x = [];
    xx = new THREE.Vector3();
    renderer.render(scene, camera);
    lengthVals = [];
    fingerLengths = [66.045, 63.635, 50.07, 63.65, 70.206, 67.6442, 71.8168, 72.3318, 72.6944, 72.9638, 73.1665, 73.312, 73.4207, 73.4988, 73.5561, 73.5991, 73.6301, 73.653, 73.6699, 73.6823, 73.6914, 73.698, 73.7029, 73.7065, 73.7091, 73.711, 73.7124, 73.7135, 73.7142, 73.7148, 73.7152, 73.7155, 73.7157, 73.7159, 73.716, 73.7161, 73.7162, 71.0263, 71.0264, 73.7163, 55.8858, 71.0431, 71.5765, 68.9647, 54.2636, 68.9809];
    avg = 0;
    for (_i = 0, _len = fingerLengths.length; _i < _len; _i++) {
      num = fingerLengths[_i];
      avg += num;
    }
    console.log(avg / fingerLengths.length);
    return Leap.loop(function(frame) {
      var i, leapFinger, leapHand;
      if (leapHand = frame.hands[0]) {
        handMesh.position.fromArray(leapHand.stabilizedPalmPosition).divideScalar(20);
        sphere.position.copy(handMesh.position);
        handMesh.position.sub((new THREE.Vector3()).fromArray(leapHand.direction).multiplyScalar(3.5));
        sphere2.position.copy(handMesh.position);
        i = 1;
        leapFinger = leapHand.fingers[i];
        palmNormal.fromArray(leapHand.palmNormal).multiplyScalar(-1);
        palmDirection.fromArray(leapHand.direction);
        palm.matrix.lookAt(palmDirection, zeroVector, palmNormal);
        palm.matrix.decompose(palm.position, palm.quaternion, palm.scale);
        palm.updateMatrixWorld(true);
        a.fromArray(leapHand.direction).visualize();
        Leap.vec3.subtract(x, leapFinger.pipPosition, leapFinger.mcpPosition);
        b.fromArray(x).normalize();
        rigFingers[i].quaternion.setFromVectors(b, a);
        rigFingers[i].quaternion.multiply(palm.quaternion.clone().inverse());
        return renderer.render(scene, camera);
      }
    });
  });

}).call(this);

/*
//@ sourceMappingURL=main.map
*/
